#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <xc.h>
#include <string.h>
#include <math.h>
#include "gpu.h"
#include "sprites.h"


struct Sprite s[MAX_SPRITES];

__eds__ struct Particle p[MAX_PARTICLES];

uint16_t color_array[11] = {0,0,0,0,0,0,0,0,0,0,0};

__prog__ uint16_t SpriteInfoMap[] __attribute__((space(prog))) = {
// Sonic 40 x 51
0x0028,
0x0033,
0x0010,
0x0000,
0x0000,
0x7e0,	// Color Table
0xb5ba,
0x6b56,
0x1973,
0xed71,
0xffff,
0x10a2,
0xc0a2,
0x0,
0x0,
0x0

// Sonic Intro Screen
/*
0x0028,	// FIX DOWN
0x0033,
0x0010,
0x07e0,
0x0000,	// FIX UP
0x191c, // Color Table
0x195d,
0x2950,
0x8983,
0xcd23,
0x4c1a,
0xac8e,
0xceba,
0x3106,
0x0,
0x0,
*/
};

__prog__ uint8_t SpriteMap[] __attribute__((space(prog)))= {
// Sonic 40 x 51 (8bpp but really 16bpp)
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x2,0x2,0x2,0x2,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x1,0x1,0x1,0x1,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x1,0x1,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x1,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x0,0x0,0x0,0x0,0x1,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x4,0x4,0x3,0x3,0x2,0x3,0x3,0x3,0x3,0x3,0x0,0x1,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x1,0x1,0x3,0x3,0x3,0x3,0x3,0x2,0x4,0x4,0x2,0x3,0x2,0x2,0x2,0x2,0x3,0x3,0x2,0x3,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x2,0x3,0x2,0x2,0x2,0x2,0x3,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x4,0x3,0x2,0x2,0x2,0x2,0x2,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x3,0x4,0x4,0x2,0x3,0x3,0x2,0x2,0x2,0x2,0x2,0x2,0x2,0x3,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x2,0x2,0x1,0x1,0x2,0x2,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x2,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x2,0x2,0x3,0x2,0x2,0x2,0x2,0x3,0x3,0x3,0x3,0x3,0x2,0x2,0x2,0x3,0x3,0x2,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x3,0x3,0x3,0x3,0x2,0x3,0x3,0x3,0x2,0x2,0x1,0x1,0x2,0x2,0x3,0x3,0x3,0x2,0x2,0x2,0x2,0x2,0x3,0x3,0x3,0x3,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x3,0x3,0x3,0x2,0x3,0x3,0x3,0x2,0x3,0x3,0x2,0x5,0x2,0x3,0x3,0x3,0x3,0x1,0x5,0x5,0x5,0x2,0x3,0x3,0x3,0x3,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x2,0x3,0x3,0x3,0x1,0x5,0x5,0x5,0x5,0x5,0x3,0x3,0x3,0x2,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x1,0x5,0x5,0x5,0x5,0x5,0x5,0x3,0x3,0x3,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x1,0x1,0x1,0x1,0x1,0x2,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x3,0x3,0x3,0x3,0x3,0x1,0x5,0x5,0x5,0x5,0x5,0x6,0x2,0x2,0x3,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x1,0x1,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x3,0x3,0x3,0x2,0x1,0x5,0x5,0x5,0x5,0x6,0x6,0x2,0x6,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x2,0x2,0x2,0x1,0x5,0x5,0x5,0x5,0x6,0x2,0x2,0x4,0x3,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x1,0x4,0x4,0x4,0x4,0x1,0x4,0x5,0x5,0x5,0x4,0x4,0x1,0x6,0x6,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x2,0x3,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x1,0x1,0x4,0x4,0x4,0x6,0x6,0x6,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x6,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x2,0x3,0x2,0x2,0x3,0x3,0x3,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x4,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x2,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x4,0x2,0x4,0x4,0x4,0x4,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x3,0x3,0x3,0x4,0x1,0x1,0x4,0x0,0x0,0x1,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x3,0x3,0x3,0x4,0x4,0x4,0x5,0x4,0x2,0x1,0x5,0x1,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x4,0x4,0x4,0x4,0x2,0x3,0x2,0x4,0x4,0x4,0x5,0x5,0x5,0x2,0x2,0x5,0x5,0x1,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x1,0x4,0x4,0x2,0x1,0x1,0x5,0x5,0x5,0x4,0x4,0x4,0x4,0x5,0x4,0x2,0x2,0x1,0x2,0x2,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x1,0x1,0x1,0x1,0x5,0x5,0x1,0x4,0x4,0x4,0x4,0x4,0x2,0x2,0x1,0x2,0x1,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x2,0x1,0x1,0x1,0x1,0x5,0x1,0x5,0x1,0x4,0x4,0x4,0x3,0x3,0x2,0x2,0x1,0x1,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x2,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x1,0x2,0x2,0x2,0x1,0x2,0x2,0x2,0x1,0x2,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x2,0x1,0x1,0x1,0x1,0x1,0x2,0x2,0x2,0x3,0x3,0x0,0x2,0x2,0x2,0x2,0x2,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x2,0x2,0x1,0x1,0x1,0x2,0x2,0x2,0x3,0x3,0x3,0x0,0x0,0x2,0x3,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x2,0x2,0x2,0x2,0x2,0x3,0x5,0x1,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x2,0x2,0x2,0x3,0x2,0x5,0x2,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x2,0x1,0x5,0x5,0x2,0x3,0x3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x3,0x3,0x2,0x5,0x5,0x5,0x3,0x3,0x3,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x1,0x3,0x3,0x2,0x5,0x5,0x1,0x2,0x3,0x3,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x1,0x1,0x1,0x1,0x1,0x1,0x2,0x2,0x1,0x1,0x1,0x1,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x3,0x2,0x2,0x1,0x1,0x1,0x2,0x2,0x2,0x1,0x1,0x1,0x2,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x7,0x2,0x1,0x1,0x7,0x3,0x7,0x7,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x6,0x7,0x7,0x7,0x7,0x7,0x2,0x6,0x2,0x2,0x2,0x6,0x7,0x7,0x7,0x7,0x1,0x1,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x6,0x7,0x1,0x5,0x5,0x5,0x5,0x5,0x7,0x7,0x7,0x6,0x7,0x7,0x7,0x7,0x1,0x1,0x1,0x7,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x1,0x7,0x7,0x7,0x7,0x7,0x7,0x5,0x7,0x6,0x7,0x7,0x7,0x2,0x1,0x1,0x1,0x7,0x7,0x7,0x7,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x7,0x7,0x7,0x7,0x7,0x1,0x7,0x7,0x7,0x6,0x7,0x7,0x7,0x2,0x1,0x1,0x7,0x7,0x7,0x7,0x7,0x1,0x7,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x6,0x7,0x7,0x2,0x2,0x2,0x1,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x6,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x6,0x6,0x7,0x7,0x2,0x2,0x2,0x2,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x7,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x6,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
// Sonic Intro Screen (4bpp but really 16bpp)
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x2,0x1,0x0,0x0,0x10,0x20,0x20,0x20,0x20,0x20,0x10,0x0,0x0,0x0,0x0,0x0,0x1,0x1,0x3,0x13,0x13,0x12,0x11,0x10,0x30,0x30,0x30,0x30,0x30,0x30,0x20,0x10,0x10,0x0,0x0,0x1,0x3,0x13,0x13,0x33,0x33,0x33,0x33,0x31,0x30,0x30,0x30,0x31,0x30,0x30,0x30,0x30,0x30,0x0,0x1,0x3,0x13,0x33,0x33,0x32,0x33,0x33,0x33,0x33,0x32,0x30,0x20,0x33,0x30,0x30,0x30,0x30,0x30,0x0,0x0,0x0,0x3,0x3,0x3,0x33,0x33,0x34,0x33,0x33,0x33,0x33,0x31,0x33,0x30,0x40,0x40,0x30,0x30,0x0,0x0,0x0,0x1,0x1,0x3,0x3,0x12,0x14,0x13,0x32,0x32,0x33,0x33,0x33,0x20,0x40,0x40,0x20,0x30,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x4,0x4,0x2,0x12,0x32,0x33,0x33,0x33,0x40,0x40,0x40,0x40,0x20,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x4,0x4,0x4,0x2,0x22,0x32,0x33,0x33,0x40,0x40,0x40,0x40,0x40,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x4,0x2,0x3,0x32,0x32,0x32,0x33,0x33,0x40,0x40,0x20,0x30,0x30,0x0,0x0,0x0,0x3,0x3,0x3,0x23,0x33,0x33,0x32,0x32,0x31,0x32,0x33,0x33,0x30,0x30,0x30,0x30,0x20,0x0,0x0,0x2,0x3,0x23,0x23,0x32,0x33,0x32,0x32,0x33,0x33,0x22,0x22,0x23,0x31,0x20,0x20,0x20,0x20,0x0,0x2,0x3,0x23,0x32,0x33,0x32,0x31,0x32,0x23,0x33,0x32,0x32,0x23,0x23,0x11,0x10,0x20,0x20,0x30,0x0,0x3,0x23,0x32,0x33,0x32,0x33,0x25,0x33,0x33,0x31,0x25,0x32,0x33,0x23,0x50,0x20,0x30,0x30,0x30,0x2,0x23,0x33,0x33,0x33,0x33,0x33,0x32,0x33,0x33,0x35,0x35,0x35,0x33,0x32,0x20,0x20,0x30,0x30,0x30,0x3,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x33,0x35,0x35,0x35,0x33,0x33,0x30,0x30,0x30,0x30,0x30,0x1,0x11,0x11,0x12,0x13,0x13,0x13,0x23,0x33,0x33,0x35,0x35,0x35,0x32,0x23,0x30,0x30,0x30,0x30,0x30,0x0,0x0,0x0,0x1,0x1,0x3,0x3,0x13,0x13,0x13,0x31,0x35,0x35,0x36,0x36,0x30,0x20,0x30,0x30,0x30,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x2,0x31,0x35,0x35,0x32,0x34,0x32,0x30,0x30,0x20,0x20,0x0,0x0,0x0,0x0,0x3,0x3,0x3,0x3,0x11,0x34,0x34,0x34,0x35,0x34,0x31,0x36,0x30,0x10,0x40,0x40,0x0,0x0,0x0,0x1,0x3,0x2,0x3,0x13,0x34,0x34,0x34,0x24,0x31,0x34,0x36,0x36,0x40,0x40,0x40,0x40,0x0,0x0,0x0,0x3,0x3,0x3,0x13,0x33,0x34,0x34,0x34,0x34,0x34,0x34,0x36,0x30,0x40,0x40,0x40,0x40,0x0,0x0,0x1,0x3,0x3,0x13,0x33,0x33,0x34,0x34,0x34,0x34,0x34,0x34,0x34,0x30,0x30,0x40,0x40,0x40,0x0,0x0,0x3,0x3,0x3,0x32,0x33,0x33,0x23,0x34,0x24,0x24,0x34,0x34,0x30,0x30,0x30,0x30,0x40,0x40,0x0,0x0,0x3,0x2,0x0,0x30,0x33,0x23,0x3,0x3,0x2,0x4,0x14,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x3,0x3,0x3,0x3,0x23,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x0,0x0,0x0,0x0,0x0,0x2,0x3,0x4,0x4,0x3,0x3,0x21,0x34,0x30,0x31,0x40,0x40,0x40,0x40,0x30,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x4,0x4,0x3,0x14,0x34,0x34,0x31,0x41,0x41,0x40,0x40,0x30,0x30,0x0,0x0,0x0,0x0,0x0,0x3,0x4,0x4,0x2,0x2,0x34,0x35,0x35,0x42,0x45,0x41,0x40,0x20,0x30,0x20,0x0,0x0,0x0,0x0,0x0,0x1,0x4,0x1,0x5,0x5,0x34,0x14,0x44,0x42,0x22,0x11,0x10,0x50,0x50,0x50,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x1,0x1,0x5,0x4,0x4,0x14,0x22,0x12,0x11,0x10,0x10,0x50,0x50,0x0,0x0,0x0,0x0,0x0,0x2,0x2,0x1,0x1,0x1,0x1,0x24,0x33,0x22,0x11,0x11,0x10,0x10,0x50,0x10,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x1,0x1,0x1,0x1,0x12,0x31,0x22,0x11,0x12,0x10,0x10,0x10,0x10,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x1,0x1,0x1,0x2,0x3,0x20,0x32,0x22,0x11,0x10,0x10,0x10,0x10,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x2,0x1,0x2,0x2,0x3,0x10,0x22,0x22,0x20,0x10,0x10,0x10,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x2,0x2,0x5,0x3,0x0,0x10,0x30,0x20,0x20,0x20,0x20,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x2,0x3,0x5,0x3,0x0,0x0,0x0,0x20,0x20,0x20,0x20,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x1,0x5,0x3,0x0,0x0,0x0,0x30,0x30,0x30,0x20,0x10,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x3,0x5,0x5,0x3,0x1,0x0,0x10,0x30,0x30,0x30,0x20,0x50,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x1,0x3,0x5,0x1,0x3,0x1,0x10,0x20,0x10,0x30,0x30,0x20,0x50,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x1,0x1,0x1,0x2,0x1,0x11,0x20,0x10,0x10,0x10,0x10,0x10,0x10,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x2,0x1,0x2,0x2,0x1,0x12,0x30,0x20,0x20,0x10,0x10,0x10,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x6,0x6,0x6,0x2,0x1,0x13,0x67,0x60,0x60,0x60,0x60,0x60,0x60,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x7,0x2,0x2,0x2,0x27,0x67,0x71,0x77,0x70,0x70,0x70,0x20,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x5,0x5,0x5,0x7,0x66,0x67,0x77,0x11,0x57,0x50,0x50,0x50,0x50,0x0,0x0,0x0,0x0,0x0,0x6,0x1,0x7,0x7,0x7,0x7,0x67,0x77,0x11,0x71,0x77,0x77,0x70,0x70,0x70,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x7,0x7,0x7,0x7,0x67,0x77,0x71,0x77,0x77,0x77,0x77,0x10,0x70,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x7,0x7,0x7,0x7,0x67,0x72,0x72,0x77,0x77,0x77,0x77,0x70,0x70,0x0,0x0,0x0,0x0,0x0,0x6,0x7,0x7,0x7,0x7,0x6,0x67,0x62,0x72,0x77,0x77,0x77,0x77,0x77,0x70,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x6,0x6,0x6,0x6,0x6,0x66,0x66,0x66,0x66,0x66,0x66,0x66,0x60,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0
};

/* Sprites */
void loadAllSprites(void) 
{
	uint16_t id, ia, off_data, off_info;
	off_data = 0;
	off_info = 0;

	for (id=0; id < 1; id++) 
	{
		s[id].info.width  =  SpriteInfoMap[off_info + SPR_OFF_WIDTH];
		s[id].info.height  =  SpriteInfoMap[off_info + SPR_OFF_HEIGHT];
		s[id].info.bitres  =  SpriteInfoMap[off_info + SPR_OFF_BITRES];
		s[id].info.trans  =  SpriteInfoMap[off_info + SPR_OFF_TRANS];
		s[id].info.rotate  =  SpriteInfoMap[off_info + SPR_OFF_ROTATE];

		for(ia=0; ia < 11; ia++)
		{
			s[id].info.color_array[ia]  =  SpriteInfoMap[off_info + SPR_OFF_COLOR + ia];
		}

		s[id].data   = &SpriteMap[off_data];

		off_info += SPR_INFO_HEAD;
		off_data += s[id].info.width * s[id].info.height;
	}
}

void inline loadSpriteCLUT(uint16_t id)
{
	/* LEGACY
	unsigned int w,h,c;
	uint16_t color;
	uint8_t new_color_idx = 0;

	for (h=0; h < s[id].height; h++) 
	{
		for (w=0; w < s[id].width; w++) 
		{
			color = s[id].data[w + s[id].width*h];

			if(new_color_idx == 0)
			{
				color_array[new_color_idx] = color;
				new_color_idx++;
			}
			else
			{
				// Search
				for(c=0; c<8; c++)
				{
					if(color_array[c] == color)
					{
						c = 10;
					}
					else if(c == 7)
					{
						color_array[new_color_idx] = color;
						if(new_color_idx < 7)
						{
							new_color_idx++;
						}
					}
				}
			}
		}
	}
	*/
	uint8_t clut_idx = 0;
	for(clut_idx=0; clut_idx<11; clut_idx++)
	{
		clut_set(clut_idx, s[id].info.color_array[clut_idx]);
	}
}


void inline drawSprite(uint16_t x, uint16_t y, uint16_t id, uint16_t rotation) 
{
	unsigned int w,h;
	uint16_t x1,y1;
	uint16_t color;

	if (x >= HOR_RES-1 || y >= VER_RES-1 || x <= 0|| y <= 0) return;

	for (h=0; h < s[id].info.height; h++) {
		for (w=0; w < s[id].info.width; w++) {
			color = s[id].data[w + s[id].info.width*h];
			// don't draw if it matches transparency color
			if (color == s[id].info.trans) continue;
			
			rcc_color(color);

			//rcc_color(color);
			//rcc_color(rand()); tv screen effect

			switch(rotation) {
				//  00 deg      0,0 1,0 2,0 ... 0,1
				//  90 deg CCW  7,0 7,1 7,2 ... 6,0
				// 180 deg      7,7 6,7 5,7 ... 7,6
				//  90 deg CW   0,7 0,6 0,5 ... 1,6
				case 0: // 0 degree
					x1 = x + w;
					y1 = y + h; // (h<<2) + (h<<1);//y+(PIX_H*h);
					if (x1 >= HOR_RES-2) continue; //br
					if (y1 >= VER_RES-PIX_H) return; //ret
					fast_pixel(x1, y1);
					break;
				case 1: // 90 degree CW
					x1 = x+(s[id].info.width-h-1);
					y1 = y+(PIX_H*(w));
					if (x1 >= HOR_RES-1 || x1 <= 0) continue;
					if (y1 >= VER_RES-PIX_H || y1 <= 0) continue;
					fast_pixel(x1, y1);
					break;
				case 2: // 180 degree CW
					x1 = x+(s[id].info.width-w-1);
					y1 = y+(PIX_H*(s[id].info.height-h-1));
					if (x1 >= HOR_RES-1) continue;
					if (y1 >= VER_RES-PIX_H) continue;
					fast_pixel(x1, y1);
					break;
				case 3: // 90 degree CCW
					break;
				default:
					break;
			}
			
		}
	}
	//Nop();
}

int inline nrange(double a, double b) 
{
	return (int)((a >= b) ? a-b : b-a);
}

void drawSpriteRotation(uint16_t x, uint16_t y, uint16_t id, float rotation) 
{
	int x1,y1,x2,y2;
	unsigned int w,h, real_x, real_y;
	uint16_t color;
	unsigned int shade = 0;
	float r_s,r_c;

	r_s = sin(rotation);
	r_c = cos(rotation);
 
	for (h=0; h < s[id].info.height; h++) {
		for (w=0; w < s[id].info.width; w++) {
			color = s[id].data[w + s[id].info.width*h];
			if (color == s[id].info.trans) continue;
			rcc_color(color+shade);

			x1 = -(s[id].info.width/2-w); // negative for origin centering 
			y1 = (s[id].info.height/2-h);
			x2 = x1*r_c - y1*r_s;
			y2 = x1*r_s + y1*r_c;

			real_x = x+nrange(x1,x2);
			real_y = y + PIX_H*nrange(y1,y2);

			if (real_x >= HOR_RES-1 || real_x <= 0) continue;
			if (real_y >= VER_RES-PIX_H || real_y <= 0) continue; // PIX_H for screen bordered setup
			//rcc_draw(real_x, real_y, 1, PIX_H);
			fast_pixel(real_x, real_y);
		}
	}
}

/* Particles */
int numPart=0;

void addParticle(void)
{
    p[numPart].size = 1;
    p[numPart].posx = rand() % (HOR_RES-2);
    p[numPart].posy = 1+(rand() % (VER_RES-7));
    p[numPart].speedx = 1+(rand() % 2);
    p[numPart].speedy = 0;
    p[numPart].color = rand();
    numPart++;
}
